DROP VIEW LastTransDateByPart;

CREATE VIEW LastTransDateByPart AS
SELECT
	AFPART,
	AFWH,
	MAX(CAST(
		CASE
		WHEN AFADTM > 0 THEN CONCAT(CONCAT(CONCAT(CONCAT(AFADTY+2000,'-'), INT((AFADTM - RIGHT(AFADTM,2))/100 )), '-'), RIGHT(AFADTM,2) )
		ELSE NULL
		END
	AS DATE)) AS LASTTRANSDATE
	
FROM FRNDTA032.AFP
WHERE AFPROG <> 'PIR6'
GROUP BY AFPART, AFWH;

GRANT ALL ON LastTransDateByPart TO PUBLIC;